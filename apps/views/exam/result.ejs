<%- include("../partical/header", { title: "Kết quả bài thi" }) %>

  <!-- Breadcrumb -->
  <nav class="breadcrumb">
    <a href="/" class="breadcrumb__item">Trang chủ</a>
    <span class="breadcrumb__separator">›</span>
    <a href="/subjects" class="breadcrumb__item">Môn học</a>
    <span class="breadcrumb__separator">›</span>
    <span class="breadcrumb__item breadcrumb__item--current">Kết quả</span>
  </nav>

  <div class="result-page">
    <!-- Header -->
    <div class="result-header">
      <h1 class="result-title">Kết quả bài thi</h1>
      <p class="result-subtitle">Chúc mừng bạn đã hoàn thành bài thi!</p>
    </div>

    <!-- Main Score Card -->
    <div class="result-card">
      <!-- Circular Progress -->
      <div class="result-score-section">
        <div class="result-score-circle"
          data-score="<%= result.total > 0 ? Math.round((result.correctCount / result.total) * 100) : 0 %>">
          <svg class="result-progress-ring" width="200" height="200">
            <circle class="result-progress-bg" cx="100" cy="100" r="85" />
            <circle class="result-progress-bar" cx="100" cy="100" r="85" />
          </svg>
          <div class="result-score-content">
            <div class="result-score-value">
              <%= result.score %>
            </div>
            <div class="result-score-label">điểm</div>
          </div>
        </div>

        <!-- Pass/Fail Badge -->
        <% if (result.score>= 50) { %>
          <div class="result-badge result-badge--pass">
            <svg class="result-badge-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
              <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            Đạt
          </div>
          <% } else { %>
            <div class="result-badge result-badge--fail">
              <svg class="result-badge-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <line x1="15" y1="9" x2="9" y2="15" />
                <line x1="9" y1="9" x2="15" y2="15" />
              </svg>
              Chưa đạt
            </div>
            <% } %>
      </div>

      <!-- Statistics Grid -->
      <div class="result-stats">
        <div class="result-stat result-stat--correct">
          <div class="result-stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
              <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
          </div>
          <div class="result-stat-value">
            <%= result.correctCount %>
          </div>
          <div class="result-stat-label">Câu đúng</div>
        </div>

        <div class="result-stat result-stat--wrong">
          <div class="result-stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <line x1="15" y1="9" x2="9" y2="15" />
              <line x1="9" y1="9" x2="15" y2="15" />
            </svg>
          </div>
          <div class="result-stat-value">
            <%= result.total - result.correctCount %>
          </div>
          <div class="result-stat-label">Câu sai</div>
        </div>

        <div class="result-stat result-stat--total">
          <div class="result-stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
              <line x1="9" y1="9" x2="15" y2="9" />
              <line x1="9" y1="13" x2="15" y2="13" />
              <line x1="9" y1="17" x2="12" y2="17" />
            </svg>
          </div>
          <div class="result-stat-value">
            <%= result.total %>
          </div>
          <div class="result-stat-label">Tổng số câu</div>
        </div>

        <div class="result-stat result-stat--percent">
          <div class="result-stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="5" x2="5" y2="19" />
              <circle cx="6.5" cy="6.5" r="2.5" />
              <circle cx="17.5" cy="17.5" r="2.5" />
            </svg>
          </div>
          <div class="result-stat-value">
            <%= result.total> 0 ? Math.round((result.correctCount / result.total) * 100) : 0 %>%
          </div>
          <div class="result-stat-label">Tỷ lệ đúng</div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="result-progress-section">
        <div class="result-progress-header">
          <span>Tiến độ</span>
          <span>
            <%= result.correctCount %>/<%= result.total %> câu đúng
          </span>
        </div>
        <div class="result-progress-track">
          <div class="result-progress-fill"
            style="width: <%= result.total > 0 ? (result.correctCount / result.total * 100) : 0 %>%"></div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="result-actions">
      <% if (result.attemptId) { %>
        <a href="/exam/attempt/<%= result.attemptId %>" class="btn btn-primary btn--lg">
          <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
            <polyline points="10 9 9 9 8 9" />
          </svg>
          Xem chi tiết bài làm
        </a>
        <% } %>

          <a href="/exam/history" class="btn btn-secondary">
            <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <polyline points="12 6 12 12 16 14" />
            </svg>
            Lịch sử thi
          </a>

          <a href="/subjects" class="btn btn-secondary">
            <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
              <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            Về danh sách môn học
          </a>
    </div>
  </div>

  <style>
    /* Result Page Styles */
    .result-page {
      max-width: 700px;
      margin: 0 auto;
      padding-bottom: var(--spacing-2xl);
    }

    .result-header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
    }

    .result-title {
      font-size: 32px;
      font-weight: 700;
      color: var(--color-text-main);
      margin: 0 0 var(--spacing-sm) 0;
    }

    .result-subtitle {
      font-size: 16px;
      color: var(--color-text-muted);
      margin: 0;
    }

    .result-card {
      background: var(--color-bg-card);
      border-radius: var(--radius-lg);
      padding: var(--spacing-2xl);
      box-shadow: var(--shadow-lg);
      margin-bottom: var(--spacing-xl);
    }

    /* Score Section */
    .result-score-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: var(--spacing-2xl);
    }

    .result-score-circle {
      position: relative;
      width: 200px;
      height: 200px;
      margin-bottom: var(--spacing-lg);
    }

    .result-progress-ring {
      transform: rotate(-90deg);
    }

    .result-progress-bg {
      fill: none;
      stroke: #e2e8f0;
      stroke-width: 12;
    }

    .result-progress-bar {
      fill: none;
      stroke: var(--color-primary);
      stroke-width: 12;
      stroke-linecap: round;
      stroke-dasharray: 534;
      stroke-dashoffset: 534;
      transition: stroke-dashoffset 1.5s ease-out;
    }

    .result-score-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .result-score-value {
      font-size: 56px;
      font-weight: 700;
      color: var(--color-primary);
      line-height: 1;
    }

    .result-score-label {
      font-size: 16px;
      color: var(--color-text-muted);
      margin-top: var(--spacing-xs);
    }

    /* Badge */
    .result-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: var(--radius-full);
      font-weight: 600;
      font-size: 16px;
    }

    .result-badge-icon {
      width: 20px;
      height: 20px;
    }

    .result-badge--pass {
      background: var(--color-primary-soft);
      color: var(--color-primary-dark);
    }

    .result-badge--fail {
      background: #fee2e2;
      color: #dc2626;
    }

    /* Statistics Grid */
    .result-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-xl);
    }

    @media (max-width: 600px) {
      .result-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .result-stat {
      text-align: center;
      padding: var(--spacing-lg);
      border-radius: var(--radius-md);
      background: #f8fafc;
    }

    .result-stat-icon {
      width: 32px;
      height: 32px;
      margin: 0 auto var(--spacing-sm);
    }

    .result-stat-icon svg {
      width: 100%;
      height: 100%;
    }

    .result-stat--correct {
      background: var(--color-primary-soft);
    }

    .result-stat--correct .result-stat-icon {
      color: var(--color-primary);
    }

    .result-stat--correct .result-stat-value {
      color: var(--color-primary);
    }

    .result-stat--wrong {
      background: #fee2e2;
    }

    .result-stat--wrong .result-stat-icon {
      color: #dc2626;
    }

    .result-stat--wrong .result-stat-value {
      color: #dc2626;
    }

    .result-stat--total {
      background: #e0f2fe;
    }

    .result-stat--total .result-stat-icon {
      color: #0284c7;
    }

    .result-stat--total .result-stat-value {
      color: #0284c7;
    }

    .result-stat--percent {
      background: #fef3c7;
    }

    .result-stat--percent .result-stat-icon {
      color: #d97706;
    }

    .result-stat--percent .result-stat-value {
      color: #d97706;
    }

    .result-stat-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: var(--spacing-xs);
    }

    .result-stat-label {
      font-size: 13px;
      color: var(--color-text-muted);
    }

    /* Progress Section */
    .result-progress-section {
      background: #f8fafc;
      padding: var(--spacing-lg);
      border-radius: var(--radius-md);
    }

    .result-progress-header {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: var(--color-text-muted);
      margin-bottom: var(--spacing-sm);
    }

    .result-progress-track {
      width: 100%;
      height: 10px;
      background: #e2e8f0;
      border-radius: var(--radius-full);
      overflow: hidden;
    }

    .result-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--color-primary), #10b981);
      border-radius: var(--radius-full);
      transition: width 1s ease-out;
    }

    /* Action Buttons */
    .result-actions {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      align-items: center;
    }

    .result-actions .btn {
      min-width: 280px;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    @media (max-width: 400px) {
      .result-actions .btn {
        min-width: 100%;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Animate circular progress
      const circle = document.querySelector('.result-score-circle');
      const progressBar = document.querySelector('.result-progress-bar');

      if (circle && progressBar) {
        const score = parseInt(circle.dataset.score) || 0;
        const circumference = 2 * Math.PI * 85; // r = 85
        const offset = circumference - (score / 100) * circumference;

        // Trigger animation after a small delay
        setTimeout(() => {
          progressBar.style.strokeDashoffset = offset;
        }, 100);
      }
    });
  </script>

  <%- include("../partical/footer") %>