<%- include("../partical/header", { title: "Kết quả bài thi" }) %>

  <nav class="breadcrumb">
    <a href="/" class="breadcrumb__item">Trang chủ</a>
    <span class="breadcrumb__separator">›</span>
    <a href="/subjects" class="breadcrumb__item">Môn học</a>
    <span class="breadcrumb__separator">›</span>
    <span class="breadcrumb__item breadcrumb__item--current">Kết quả</span>
  </nav>

  <div class="result-page">
    <div class="result-header">
      <h1 class="result-title">Kết quả bài thi</h1>
      <p class="result-subtitle">Chúc mừng bạn đã hoàn thành bài thi!</p>
    </div>

    <div class="result-card">
      <div class="result-score-section">
        <div class="result-score-circle"
          data-score="<%= result.total > 0 ? Math.round((result.correctCount / result.total) * 100) : 0 %>">
          <svg class="result-progress-ring" width="200" height="200">
            <circle class="result-progress-bg" cx="100" cy="100" r="85" />
            <circle class="result-progress-bar" cx="100" cy="100" r="85" />
          </svg>
          <div class="result-score-content">
            <div class="result-score-value">
              <%= result.score %>
            </div>
            <div class="result-score-label">điểm</div>
          </div>
        </div>

        <% if (result.score>= 50) { %>
          <div class="result-badge result-badge--pass">
            <svg class="result-badge-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
              <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            Đạt
          </div>
          <% } else { %>
            <div class="result-badge result-badge--fail">
              <svg class="result-badge-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <line x1="15" y1="9" x2="9" y2="15" />
                <line x1="9" y1="9" x2="15" y2="15" />
              </svg>
              Chưa đạt
            </div>
            <% } %>
      </div>

      <div class="result-stats">
        <div class="result-stat result-stat--correct">
          <div class="result-stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
              <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
          </div>
          <div class="result-stat-value">
            <%= result.correctCount %>
          </div>
          <div class="result-stat-label">Câu đúng</div>
        </div>

        <div class="result-stat result-stat--wrong">
          <div class="result-stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <line x1="15" y1="9" x2="9" y2="15" />
              <line x1="9" y1="9" x2="15" y2="15" />
            </svg>
          </div>
          <div class="result-stat-value">
            <%= result.total - result.correctCount %>
          </div>
          <div class="result-stat-label">Câu sai</div>
        </div>

        <div class="result-stat result-stat--total">
          <div class="result-stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
              <line x1="9" y1="9" x2="15" y2="9" />
              <line x1="9" y1="13" x2="15" y2="13" />
              <line x1="9" y1="17" x2="12" y2="17" />
            </svg>
          </div>
          <div class="result-stat-value">
            <%= result.total %>
          </div>
          <div class="result-stat-label">Tổng số câu</div>
        </div>

        <div class="result-stat result-stat--percent">
          <div class="result-stat-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="5" x2="5" y2="19" />
              <circle cx="6.5" cy="6.5" r="2.5" />
              <circle cx="17.5" cy="17.5" r="2.5" />
            </svg>
          </div>
          <div class="result-stat-value">
            <%= result.total> 0 ? Math.round((result.correctCount / result.total) * 100) : 0 %>%
          </div>
          <div class="result-stat-label">Tỷ lệ đúng</div>
        </div>
      </div>

      <div class="result-progress-section">
        <div class="result-progress-header">
          <span>Tiến độ</span>
          <span>
            <%= result.correctCount %>/<%= result.total %> câu đúng
          </span>
        </div>
        <div class="result-progress-track">
          <div class="result-progress-fill"
            style="width: <%= result.total > 0 ? (result.correctCount / result.total * 100) : 0 %>%"></div>
        </div>
      </div>
    </div>

    <div class="result-actions">
      <% if (result.attemptId) { %>
        <a href="/exam/attempt/<%= result.attemptId %>" class="btn btn-primary btn--lg">
          <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
            <polyline points="10 9 9 9 8 9" />
          </svg>
          Xem chi tiết bài làm
        </a>
        <% } %>

          <a href="/exam/history" class="btn btn-secondary">
            <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <polyline points="12 6 12 12 16 14" />
            </svg>
            Lịch sử thi
          </a>

          <a href="/subjects" class="btn btn-secondary">
            <svg class="btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
              <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            Về danh sách môn học
          </a>
    </div>
  </div>

  <link rel="stylesheet" href="/static/css/exam-result.css" />

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const circle = document.querySelector('.result-score-circle');
      const progressBar = document.querySelector('.result-progress-bar');

      if (circle && progressBar) {
        const score = parseInt(circle.dataset.score) || 0;
        const circumference = 2 * Math.PI * 85;
        const offset = circumference - (score / 100) * circumference;

        setTimeout(() => {
          progressBar.style.strokeDashoffset = offset;
        }, 100);
      }
    });
  </script>

  <%- include("../partical/footer") %>