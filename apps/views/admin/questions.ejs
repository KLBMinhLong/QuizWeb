<%- include("../partical/header", { title: "Admin - Questions" }) %>

<!-- Breadcrumb -->
<nav class="breadcrumb">
  <a href="/" class="breadcrumb__item">Trang chủ</a>
  <span class="breadcrumb__separator">›</span>
  <a href="/admin" class="breadcrumb__item">Quản trị</a>
  <span class="breadcrumb__separator">›</span>
  <span class="breadcrumb__item breadcrumb__item--current"
    >Quản lý câu hỏi</span
  >
</nav>

<div class="admin-header">
  <h1 class="admin-header__title">Quản lý câu hỏi</h1>
</div>

<!-- Success/Error Messages -->
<% if (success) { %>
  <div class="card mt-xl" style="background-color: #d4edda; border-color: #c3e6cb; color: #155724;">
    <p class="card__content"><%= success %></p>
  </div>
<% } %>

<% if (error) { %>
  <div class="card mt-xl" style="background-color: #f8d7da; border-color: #f5c6cb; color: #721c24;">
    <p class="card__content"><%= error %></p>
  </div>
<% } %>

<% if (message && !success && !error) { %>
  <div class="card mt-xl">
    <p class="card__content"><%= message %></p>
  </div>
<% } %>

<!-- Import Form -->
<div class="card mt-xl">
  <h2 class="card__title">Import câu hỏi từ file</h2>
  <div class="card__content">
    <form method="post" action="/admin/questions/import" enctype="multipart/form-data">
      <div style="margin-bottom: 1rem;">
        <label for="file" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">
          Chọn file Excel (.xlsx, .xls) hoặc CSV (.csv):
        </label>
        <input type="file" name="file" id="file" accept=".xlsx,.xls,.csv" required style="width: 100%; padding: 0.5rem;" />
      </div>
      <button type="submit" class="btn btn-primary" style="padding: 0.75rem 1.5rem; cursor: pointer;">
        Import
      </button>
    </form>
    
    <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #ddd;">
      <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">Định dạng file:</h3>
      <p style="color: #666; line-height: 1.6;">
        File Excel phải có sheet tên <strong>"Questions"</strong> (hoặc sheet đầu tiên) với các cột:
      </p>
      <ul style="color: #666; line-height: 1.8; margin-left: 1.5rem;">
        <li><strong>subjectSlug</strong>: Slug của môn học (ví dụ: "toan-hoc")</li>
        <li><strong>difficulty</strong>: Độ khó (easy, medium, hard)</li>
        <li><strong>type</strong>: Loại câu hỏi (single_choice, multiple_choice, true_false, fill_in_blank, matching)</li>
        <li><strong>content</strong>: Nội dung câu hỏi</li>
        <li><strong>answersJson</strong>: JSON string của đáp án (xem ví dụ bên dưới)</li>
        <li><strong>mediaUrl</strong> (tùy chọn): URL hình ảnh/video</li>
      </ul>
      
      <h4 style="margin-top: 1rem; margin-bottom: 0.5rem;">Ví dụ answersJson:</h4>
      <div style="background-color: #f5f5f5; padding: 1rem; border-radius: 4px; font-family: monospace; font-size: 0.9rem; overflow-x: auto;">
        <div style="margin-bottom: 0.5rem;"><strong>single_choice/multiple_choice:</strong></div>
        <div>[{"text":"Đáp án A","isCorrect":true},{"text":"Đáp án B","isCorrect":false}]</div>
        <div style="margin-top: 1rem; margin-bottom: 0.5rem;"><strong>true_false:</strong></div>
        <div>[{"value":true,"isCorrect":true},{"value":false,"isCorrect":false}]</div>
        <div style="margin-top: 1rem; margin-bottom: 0.5rem;"><strong>fill_in_blank:</strong></div>
        <div>{"accepted":["đáp án 1","đáp án 2"]}</div>
        <div style="margin-top: 1rem; margin-bottom: 0.5rem;"><strong>matching:</strong></div>
        <div>{"pairs":[{"left":"A","right":"1"},{"left":"B","right":"2"}]}</div>
      </div>
    </div>
  </div>
</div>

<!-- Import Errors Details -->
<% if (importErrors && importErrors.length > 0) { %>
  <div class="card mt-xl" style="background-color: #fff3cd; border-color: #ffeaa7;">
    <h3 class="card__title">Chi tiết lỗi:</h3>
    <div class="card__content">
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="border-bottom: 2px solid #ddd;">
            <th style="padding: 0.5rem; text-align: left;">Dòng</th>
            <th style="padding: 0.5rem; text-align: left;">Lỗi</th>
          </tr>
        </thead>
        <tbody>
          <% importErrors.forEach(function(err) { %>
            <tr style="border-bottom: 1px solid #eee;">
              <td style="padding: 0.5rem;"><strong><%= err.row %></strong></td>
              <td style="padding: 0.5rem;"><%= err.message %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
<% } %>

<%- include("../partical/footer") %>
