<%- include('./partials/header', { pageTitle: 'T·∫°o c√¢u h·ªèi m·ªõi' , activePage: 'question-create' , breadcrumb: 'T·∫°o m·ªõi'
  , user: typeof user !=='undefined' ? user : null }) %>

  <% if (typeof error !=='undefined' && error) { %>
    <div class="alert alert-error">
      <%= error %>
    </div>
    <% } %>

      <div class="admin-content__header">
        <div>
          <h1 class="admin-content__title">T·∫°o c√¢u h·ªèi m·ªõi</h1>
          <p class="admin-content__subtitle">Th√™m c√¢u h·ªèi m·ªõi v√†o ng√¢n h√†ng ƒë·ªÅ</p>
        </div>
        <div class="admin-content__actions">
          <a href="/admin/questions" class="admin-btn admin-btn--secondary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Quay l·∫°i
          </a>
        </div>
      </div>

      <div class="admin-panel">
        <div class="admin-panel__header">
          <h3 class="admin-panel__title">Th√¥ng tin c√¢u h·ªèi</h3>
        </div>
        <div class="admin-panel__body">
          <form method="post" action="/admin/questions/create" enctype="multipart/form-data">
            <input type="hidden" id="answers-json" name="answers" value="[]" />

            <div class="admin-form-inline">
              <div class="admin-form-group">
                <label class="admin-form-label">M√¥n h·ªçc <span style="color: #dc2626;">*</span></label>
                <select name="subjectId" id="subjectId" class="admin-form-select" required>
                  <option value="">-- Ch·ªçn m√¥n h·ªçc --</option>
                  <% if (subjects && subjects.length> 0) { %>
                    <% subjects.forEach(function(s) { %>
                      <option value="<%= s._id %>">
                        <%= s.name %>
                      </option>
                      <% }) %>
                        <% } %>
                </select>
              </div>

              <div class="admin-form-group">
                <label class="admin-form-label">ƒê·ªô kh√≥ <span style="color: #dc2626;">*</span></label>
                <select name="difficulty" id="difficulty" class="admin-form-select" required>
                  <option value="easy">D·ªÖ</option>
                  <option value="medium" selected>Trung b√¨nh</option>
                  <option value="hard">Kh√≥</option>
                </select>
              </div>

              <div class="admin-form-group">
                <label class="admin-form-label">Lo·∫°i c√¢u h·ªèi <span style="color: #dc2626;">*</span></label>
                <select name="type" id="type" class="admin-form-select" required>
                  <option value="">-- Ch·ªçn lo·∫°i c√¢u h·ªèi --</option>
                  <option value="single_choice">Tr·∫Øc nghi·ªám m·ªôt l·ª±a ch·ªçn</option>
                  <option value="multiple_choice">Tr·∫Øc nghi·ªám nhi·ªÅu l·ª±a ch·ªçn</option>
                  <option value="true_false">ƒê√∫ng/Sai</option>
                  <option value="fill_in_blank">ƒêi·ªÅn t·ª´</option>
                  <option value="matching">N·ªëi c·∫∑p</option>
                </select>
              </div>
            </div>

            <div class="admin-form-group">
              <label class="admin-form-label">N·ªôi dung c√¢u h·ªèi <span style="color: #dc2626;">*</span></label>
              <textarea name="content" id="content" class="admin-form-input" rows="4"
                placeholder="Nh·∫≠p n·ªôi dung c√¢u h·ªèi..." required style="resize: vertical;"></textarea>
            </div>

            <div class="admin-form-group">
              <label class="admin-form-label">H√¨nh ·∫£nh minh h·ªça (t√πy ch·ªçn)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="file" name="questionImage" id="questionImage" accept="image/*" class="admin-form-input"
                  style="flex: 1;" onchange="previewImage(this)" />
              </div>
              <div id="imagePreview" style="margin-top: 0.5rem; display: none;">
                <img id="previewImg" src="" alt="Preview"
                  style="max-width: 300px; max-height: 200px; border-radius: 8px; border: 1px solid #e2e8f0;" />
              </div>
              <p style="font-size: 13px; color: var(--color-text-muted); margin-top: 6px;">
                üì∑ H·ªó tr·ª£: JPG, PNG, GIF, WebP. T·ªëi ƒëa 5MB.
              </p>
            </div>

            <div class="admin-form-group" id="answers-container">
              <!-- Dynamic answers fields will be inserted here -->
            </div>

            <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-xl);">
              <button type="submit" class="admin-btn admin-btn--primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                T·∫°o c√¢u h·ªèi
              </button>
              <a href="/admin/questions" class="admin-btn admin-btn--secondary">H·ªßy</a>
            </div>
          </form>
        </div>
      </div>

      <script src="/static/js/admin-questions.js"></script>
      <script>
        function previewImage(input) {
          const preview = document.getElementById('imagePreview');
          const previewImg = document.getElementById('previewImg');

          if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
              previewImg.src = e.target.result;
              preview.style.display = 'block';
            };

            reader.readAsDataURL(input.files[0]);
          } else {
            preview.style.display = 'none';
            previewImg.src = '';
          }
        }
      </script>

      <%- include('./partials/footer') %>